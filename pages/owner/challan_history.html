<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Challan History</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root{
  --primary:#b53030;
  --bg:#f4f6fa;
  --card:#ffffff;
  --green:#065f46;
}

*{box-sizing:border-box}

body{
  margin:0;
  font-family:Poppins;
  background:var(--bg);
}

/* Header */
.header{
  padding:18px;
  text-align:center;
  background:linear-gradient(135deg,#b53030,#8f1d1d);
  color:#fff;
  font-size:18px;
  font-weight:600;
}

/* Layout */
.container{
  max-width:1200px;
  margin:auto;
  padding:16px;
}

/* Controls */
.controls{
  background:#fff;
  padding:16px;
  border-radius:18px;
  box-shadow:0 10px 30px rgba(0,0,0,.1);
  display:grid;
  gap:12px;
  margin-bottom:20px;
}

.controls input{
  padding:12px 14px;
  border-radius:12px;
  border:1px solid #e5e7eb;
  font-family:Poppins;
}

.summary{
  font-weight:600;
  color:var(--green);
  font-size:16px;
}

/* Graph */
.graphBox{
  background:#fff;
  padding:16px;
  border-radius:18px;
  box-shadow:0 10px 30px rgba(0,0,0,.1);
  margin-bottom:22px;
}

/* Grid */
.grid{
  display:grid;
  grid-template-columns:1fr;
  gap:18px;
}

/* Card */
.card{
  background:var(--card);
  border-radius:20px;
  padding:18px;
  box-shadow:0 10px 30px rgba(0,0,0,.1);
  position:relative;
}

/* Date badge */
.date{
  position:absolute;
  top:16px;
  right:16px;
  background:#fee2e2;
  color:#991b1b;
  font-size:11px;
  padding:5px 12px;
  border-radius:999px;
  font-weight:600;
}

/* Buyer */
.buyer{
  font-size:16px;
  font-weight:600;
  color:var(--primary);
  margin-bottom:8px;
}

/* Info */
.info{
  font-size:14px;
  color:#374151;
  line-height:1.7;
  margin-bottom:14px;
}

/* Divider */
.divider{
  height:1px;
  background:linear-gradient(to right, transparent, #e5e7eb, transparent);
  margin:14px 0;
}

/* Amount */
.amount{
  padding:10px 16px;
  background:#ecfdf5;
  border-radius:14px;
  font-size:18px;
  font-weight:600;
  color:var(--green);
  display:inline-block;
}

/* Actions */
.actions{
  margin-top:16px;
  display:flex;
  gap:12px;
  flex-wrap:wrap;
}

.btn{
  padding:10px 16px;
  border-radius:14px;
  background:linear-gradient(135deg,#b53030,#8f1d1d);
  color:#fff;
  text-decoration:none;
  font-size:13px;
  font-weight:600;
}

.wa{
  background:linear-gradient(135deg,#25D366,#1ebe5d);
}

/* Responsive */
@media(min-width:600px){
  .grid{grid-template-columns:repeat(2,1fr)}
  .controls{grid-template-columns:1fr 1fr}
}

@media(min-width:992px){
  .grid{grid-template-columns:repeat(3,1fr)}
}
</style>
</head>

<body>

<div class="header">ðŸ“š Challan History</div>

<div class="container">

  <!-- SEARCH -->
  <div class="controls">
    <input id="search" placeholder="ðŸ” Search buyer / vehicle / amount">
    <div class="summary" id="totalBox">Total Amount: â‚¹ 0</div>
  </div>

  <!-- GRAPH -->
  <div class="graphBox">
    <canvas id="chart"></canvas>
  </div>

  <!-- LIST -->
  <div class="grid" id="list"></div>

</div>

<script>
const API="https://script.google.com/macros/s/AKfycby6seRRb3qWV-pqNZo3O9DYSO7QSLm28p-tzWqH5w0B5u3t5cO6o-noeCRX3hLwL7mW/exec?mode=history";
let rows=[], chart;

fetch(API)
.then(r=>r.json())
.then(data=>{
  rows=data.reverse(); // ðŸ†• Latest First
  render();
});

document.getElementById("search").oninput=render;

function render(){
  const list=document.getElementById("list");
  const q=document.getElementById("search").value.toLowerCase();
  let total=0, labels=[], values=[];

  list.innerHTML="";

  rows.forEach(r=>{
    const buyer=r[3].toLowerCase();
    const vehicle=r[5].toLowerCase();
    const amount=Number(r[8]);

    if(q && !buyer.includes(q) && !vehicle.includes(q) && !String(amount).includes(q)) return;

    total+=amount;
    labels.push(r[1]);
    values.push(amount);

    list.innerHTML+=`
      <div class="card">
        <div class="date">${r[1]}</div>
        <div class="buyer">${r[3]}</div>
        <div class="info">
          ðŸšš Vehicle: ${r[5]}<br>
          ðŸ§± Type: ${r[6]}<br>
          ðŸ“¦ Qty: ${r[7]}
        </div>
        <div class="divider"></div>
        <div class="amount">â‚¹ ${amount}</div>
        <div class="actions">
          <a class="btn" target="_blank" href="${r[11]}">ðŸ“„ PDF</a>
          <a class="btn wa" target="_blank"
            href="https://wa.me/?text=${encodeURIComponent(
              'ðŸ§¾ à¤ˆà¤‚à¤Ÿ à¤šà¤¾à¤²à¤¾à¤¨\nBuyer: '+r[3]+'\nAmount: â‚¹'+amount+'\nPDF: '+r[11]
            )}">
            ðŸ“² WhatsApp
          </a>
        </div>
      </div>`;
  });

  document.getElementById("totalBox").innerText="Total Amount: â‚¹ "+total;
  drawChart(labels,values);
}

function drawChart(labels,values){
  if(chart) chart.destroy();
  chart=new Chart(document.getElementById("chart"),{
    type:"bar",
    data:{
      labels:labels,
      datasets:[{
        label:"Amount",
        data:values,
        backgroundColor:"#b53030"
      }]
    },
    options:{
      responsive:true,
      plugins:{legend:{display:false}}
    }
  });
}
</script>

</body>
</html>
