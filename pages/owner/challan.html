<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Generate Challan</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">

<style>
*{box-sizing:border-box}
body{
  margin:0;
  font-family:Poppins;
  background:
    radial-gradient(circle at top,#fdf2f2,#eef1f7 45%);
}

/* Layout */
.wrapper{
  min-height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:20px;
}

.card{
  width:100%;
  max-width:640px;
  background:rgba(255,255,255,.9);
  backdrop-filter:blur(14px);
  border-radius:22px;
  padding:26px;
  box-shadow:0 25px 60px rgba(0,0,0,.15);
  transition:.3s;
}
.card:hover{
  transform:translateY(-3px);
}

h2{
  text-align:center;
  color:#991b1b;
  margin-bottom:16px;
  font-size:22px;
}

/* Section title futuristic */
.section-title{
  display:flex;
  align-items:center;
  gap:10px;
  margin:22px 0 14px;
  font-size:14px;
  font-weight:600;
  color:#6b7280;
}
.section-title::before{
  content:"";
  flex:1;
  height:1px;
  background:linear-gradient(to right,transparent,#d1d5db);
}
.section-title::after{
  content:"";
  flex:1;
  height:1px;
  background:linear-gradient(to left,transparent,#d1d5db);
}

/* Form */
.form-grid{
  display:grid;
  grid-template-columns:1fr;
  gap:14px;
}

input,select{
  width:100%;
  padding:14px;
  border-radius:14px;
  border:1px solid #e5e7eb;
  background:#f9fafb;
  font-size:14px;
}

input:focus,select:focus{
  outline:none;
  border-color:#b53030;
  background:#fff;
  box-shadow:0 0 0 4px rgba(181,48,48,.15);
}

button{
  border:none;
  cursor:pointer;
  border-radius:14px;
  padding:14px;
  font-weight:600;
  color:#fff;
  background:linear-gradient(135deg,#b53030,#7f1d1d);
  box-shadow:0 10px 25px rgba(181,48,48,.4);
  transition:.25s;
}

button:hover:not(:disabled){
  transform:translateY(-2px);
  box-shadow:0 16px 35px rgba(181,48,48,.55);
}

button:disabled{
  opacity:.6;
  cursor:not-allowed;
}

.note{
  margin-top:14px;
  text-align:center;
  font-size:13px;
  color:#6b7280;
}

/* Result */
#resultBox{
  display:none;
  margin-top:14px;
  padding:18px;
  border-radius:18px;
  background:
    linear-gradient(135deg,#ecfdf5,#f0fdf4);
  border:1px solid #bbf7d0;
}

#resultMsg{
  font-weight:600;
  font-size:15px;
  text-align:center;
}

.result-actions{
  margin-top:14px;
  display:flex;
  gap:12px;
  justify-content:center;
  flex-wrap:wrap;
}

.result-actions button{
  padding:10px 16px;
  font-size:14px;
}

/* Responsive */
@media(min-width:600px){
  .form-grid{grid-template-columns:1fr 1fr}
  .full{grid-column:1/-1}
}
</style>
</head>

<body>

<div class="wrapper">
<div class="card">

<h2>üßæ ‡§à‡§Ç‡§ü ‡§ö‡§æ‡§≤‡§æ‡§®</h2>

<button
style="background:#111827;margin-bottom:6px"
onclick="location.href='challan_history.html'">
üìö Challan History
</button>

<div class="section-title">üìù ‡§ö‡§æ‡§≤‡§æ‡§® ‡§µ‡§ø‡§µ‡§∞‡§£ ‡§≠‡§∞‡•á‡§Ç</div>

<div class="form-grid">
  <input id="buyerInput" placeholder="‡§ñ‡§∞‡•Ä‡§¶‡§æ‡§∞ ‡§ï‡§æ ‡§®‡§æ‡§Æ">
  <input id="driverInput" placeholder="‡§°‡•ç‡§∞‡§æ‡§á‡§µ‡§∞ ‡§ï‡§æ ‡§®‡§æ‡§Æ">
  <input id="vehicleInput" placeholder="‡§µ‡§æ‡§π‡§® ‡§®‡§Ç‡§¨‡§∞">

  <select id="brickInput">
    <option value="1 ‡§®‡§Ç‡§¨‡§∞">1 ‡§®‡§Ç‡§¨‡§∞</option>
    <option value="2 ‡§®‡§Ç‡§¨‡§∞">2 ‡§®‡§Ç‡§¨‡§∞</option>
    <option value="‡§ú‡§∞">‡§∏‡•á‡§Æ‡§æ (3 ‡§®‡§Ç‡§¨‡§∞)</option>
    <option value="‡§ñ‡§Ç‡§ú‡§∞">‡§ñ‡§Ç‡§ú‡§∞</option>
    <option value="‡§ó‡•Å‡§°‡§º‡§ø‡§Ø‡§æ">‡§ó‡•Å‡§°‡§ø‡§Ø‡§æ</option>
  </select>

  <input id="qtyInput" type="number" placeholder="‡§Æ‡§æ‡§§‡•ç‡§∞‡§æ" class="full">
  <input id="priceInput" type="number" placeholder="‡§ï‡•Å‡§≤ ‡§ï‡•Ä‡§Æ‡§§ (‚Çπ)" class="full">
  <input id="throughInput" placeholder="‡§à‡§Ç‡§ü ‡§ï‡§ø‡§∏‡§ï‡•á ‡§¶‡•ç‡§µ‡§æ‡§∞‡§æ ‡§ú‡§æ ‡§∞‡§π‡•Ä ‡§π‡•à" class="full">

  <button class="full" id="genBtn" onclick="generate()">‡§ö‡§æ‡§≤‡§æ‡§® ‡§¨‡§®‡§æ‡§è‡§Ç</button>
</div>

<div class="note">
üîí ‡§ö‡§æ‡§≤‡§æ‡§® ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§∞‡•Ç‡§™ ‡§∏‡•á ‡§∏‡•á‡§µ ‡§π‡•ã‡§ó‡§æ ‡§î‡§∞ PDF ‡§ë‡§ü‡•ã-‡§ú‡§®‡§∞‡•á‡§ü ‡§π‡•ã‡§ó‡•Ä
</div>

<div class="section-title">üì¶ ‡§ö‡§æ‡§≤‡§æ‡§® ‡§∏‡•ç‡§•‡§ø‡§§‡§ø</div>

<div id="resultBox">
  <div id="resultMsg"></div>
  <div class="result-actions">
    <button id="viewPdfBtn" style="display:none">üìÑ View PDF</button>
  </div>
</div>

</div>
</div>

<!-- YOUR EXISTING SCRIPT ‚Äî UNCHANGED -->

<script>
async function translateToHindi(text){
  if(!text) return "";
  try{
    const res = await fetch(
      "https://translate.googleapis.com/translate_a/single?client=gtx&sl=en&tl=hi&dt=t&q=" +
      encodeURIComponent(text)
    );
    const data = await res.json();
    return data[0][0][0] || text;
  }catch(e){
    return text;
  }
}

async function generate(){
  const btn = genBtn;
  const resultBox = document.getElementById("resultBox");
  const resultMsg = document.getElementById("resultMsg");
  const viewBtn = document.getElementById("viewPdfBtn");

  btn.disabled = true;
  btn.innerText = "Generating...";

  const buyer = buyerInput.value.trim();
  const driver = driverInput.value.trim();
  const vehicle = vehicleInput.value.trim();
  const brick = brickInput.value;
  const qty = qtyInput.value;
  const price = priceInput.value;
  const through = throughInput.value.trim();

  if(!buyer || !driver || !vehicle || !qty || !price || !through){
    alert("‚ùå ‡§∏‡§≠‡•Ä ‡§´‡§º‡•Ä‡§≤‡•ç‡§° ‡§≠‡§∞‡§®‡§æ ‡§ú‡§º‡§∞‡•Ç‡§∞‡•Ä ‡§π‡•à");
    btn.disabled=false;
    btn.innerText="‡§ö‡§æ‡§≤‡§æ‡§® ‡§¨‡§®‡§æ‡§è‡§Ç";
    return;
  }

  const buyerHi = await translateToHindi(buyer);
  const driverHi = await translateToHindi(driver);

  const fd = new FormData();
  fd.append("buyer_name", buyer);
  fd.append("buyer_name_hindi", buyerHi);
  fd.append("driver_name", driver);
  fd.append("driver_name_hindi", driverHi);
  fd.append("vehicle_no", vehicle);
  fd.append("brick_type", brick);
  fd.append("quantity", qty);
  fd.append("total_price", price);
  fd.append("through", through);

  try{
    const res = await fetch(
      "https://script.google.com/macros/s/AKfycby6seRRb3qWV-pqNZo3O9DYSO7QSLm28p-tzWqH5w0B5u3t5cO6o-noeCRX3hLwL7mW/exec",
      { method:"POST", body:fd }
    );

    const out = JSON.parse(await res.text());

    if(out.status === "SUCCESS"){
      resultBox.style.display="block";
      resultMsg.style.color="green";
      resultMsg.innerText="‚úÖ ‡§ö‡§æ‡§≤‡§æ‡§® ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§¨‡§® ‡§ó‡§Ø‡§æ";

      // View PDF
      viewBtn.style.display="inline-block";
      viewBtn.onclick = () => window.open(out.pdfUrl, "_blank");

      // WhatsApp Share Button
      const waBtn = document.createElement("button");
      waBtn.innerText = "üì≤ WhatsApp ‡§™‡§∞ ‡§≠‡•á‡§ú‡•á‡§Ç";
      waBtn.style.background = "#25D366";
      waBtn.style.color = "#fff";
      waBtn.style.border = "none";
      waBtn.style.borderRadius = "10px";
      waBtn.style.padding = "10px 14px";
      waBtn.style.fontWeight = "600";
      waBtn.onclick = () => {
        const msg =
          `üßæ ‡§à‡§Ç‡§ü ‡§ö‡§æ‡§≤‡§æ‡§®\n\n` +
          `‡§ñ‡§∞‡•Ä‡§¶‡§æ‡§∞: ${buyerHi}\n` +
          `‡§∞‡§æ‡§∂‡§ø: ‚Çπ${price}\n\n` +
          `PDF ‡§¶‡•á‡§ñ‡•á‡§Ç:\n${out.pdfUrl}`;
        window.open(
          "https://wa.me/?text=" + encodeURIComponent(msg),
          "_blank"
        );
      };

      document.querySelector(".result-actions").appendChild(waBtn);

    }else{
      throw "fail";
    }

  }catch(e){
    resultBox.style.display="block";
    resultMsg.style.color="red";
    resultMsg.innerText="‚ùå Server error";
  }

  btn.disabled=false;
  btn.innerText="‡§ö‡§æ‡§≤‡§æ‡§® ‡§¨‡§®‡§æ‡§è‡§Ç";
}
</script>


</body>
</html>
