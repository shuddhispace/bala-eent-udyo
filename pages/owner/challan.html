<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Generate Challan</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">

<style>
*{box-sizing:border-box}
body{
  margin:0;
  font-family:Poppins;
  background:linear-gradient(135deg,#f4f6fa,#eef1f7);
}

/* Layout */
.wrapper{
  min-height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:16px;
}

.card{
  width:100%;
  max-width:620px;
  background:#fff;
  border-radius:20px;
  padding:22px;
  box-shadow:0 15px 35px rgba(0,0,0,.12)
}

h2{
  text-align:center;
  color:#b53030;
  margin-bottom:18px
}

/* Form */
.form-grid{
  display:grid;
  grid-template-columns:1fr;
  gap:12px
}

input,select,button{
  width:100%;
  padding:14px;
  border-radius:12px;
  border:1px solid #ccc;
  font-family:Poppins;
  font-size:15px
}

input[readonly]{
  background:#f3f4f6;
  color:#444;
}

button{
  background:#b53030;
  color:#fff;
  border:none;
  font-weight:600;
  cursor:pointer;
  transition:.2s
}
button:disabled{
  opacity:.6;
  cursor:not-allowed
}
button:hover:not(:disabled){
  transform:translateY(-1px)
}

.note{
  margin-top:10px;
  text-align:center;
  font-size:13px;
  color:#666
}

/* Result Box */
#resultBox{
  display:none;
  margin-top:18px;
  padding:14px;
  border-radius:14px;
  background:#f9fafb;
  text-align:center
}
#resultMsg{
  font-weight:600;
  font-size:15px
}
.result-actions{
  margin-top:12px;
  display:flex;
  gap:10px;
  justify-content:center;
  flex-wrap:wrap
}
.result-actions button{
  width:auto;
  padding:10px 14px;
  border-radius:10px;
  font-size:14px
}

/* Responsive */
@media(min-width:600px){
  .form-grid{grid-template-columns:1fr 1fr}
  .full{grid-column:1/-1}
}
</style>
</head>

<body>

<div class="wrapper">
  <div class="card">

    <h2>üßæ ‡§à‡§Ç‡§ü ‡§ö‡§æ‡§≤‡§æ‡§®</h2>
    <button 
  style="
    width:100%;
    margin-bottom:14px;
    background:#1f2937;
    color:#fff;
    border:none;
    border-radius:12px;
    padding:12px;
    font-family:Poppins;
    font-weight:600;
    cursor:pointer
  "
  onclick="location.href='challan_history.html'">
  üìö Challan History
</button>


    <div class="form-grid">
      <input id="buyerInput" placeholder="‡§ñ‡§∞‡•Ä‡§¶‡§æ‡§∞ ‡§ï‡§æ ‡§®‡§æ‡§Æ">
      <input id="driverInput" placeholder="‡§°‡•ç‡§∞‡§æ‡§á‡§µ‡§∞ ‡§ï‡§æ ‡§®‡§æ‡§Æ">
      <input id="vehicleInput" placeholder="‡§µ‡§æ‡§π‡§® ‡§®‡§Ç‡§¨‡§∞">

      <select id="brickInput">
        <option value="1 ‡§®‡§Ç‡§¨‡§∞">1 ‡§®‡§Ç‡§¨‡§∞</option>
        <option value="2 ‡§®‡§Ç‡§¨‡§∞">2 ‡§®‡§Ç‡§¨‡§∞</option>
        <option value="‡§ú‡§∞">‡§∏‡•á‡§Æ‡§æ (3 ‡§®‡§Ç‡§¨‡§∞)</option>
        <option value="‡§ñ‡§Ç‡§ú‡§∞">‡§ñ‡§Ç‡§ú‡§∞</option>
        <option value="‡§ó‡•Å‡§°‡§º‡§ø‡§Ø‡§æ">‡§ó‡•Å‡§°‡§ø‡§Ø‡§æ</option>
      </select>

      <input id="qtyInput" type="number" placeholder="‡§Æ‡§æ‡§§‡•ç‡§∞‡§æ" class="full">
      <input id="priceInput" type="number" placeholder="‡§ï‡•Å‡§≤ ‡§ï‡•Ä‡§Æ‡§§ (‚Çπ)" class="full">

      <!-- THROUGH ENGLISH -->
      <input id="throughInput" placeholder="‡§à‡§Ç‡§ü ‡§ï‡§ø‡§∏‡§ï‡•á ‡§¶‡•ç‡§µ‡§æ‡§∞‡§æ ‡§ú‡§æ ‡§∞‡§π‡•Ä ‡§π‡•à" class="full">
      <!-- <input 
  id="throughHindiPreview"
  class="full"
  placeholder="‡§π‡§ø‡§Ç‡§¶‡•Ä ‡§™‡•ç‡§∞‡•Ä‡§µ‡•ç‡§Ø‡•Ç"
  readonly
> -->


      <button class="full" id="genBtn" onclick="generate()">‡§ö‡§æ‡§≤‡§æ‡§® ‡§¨‡§®‡§æ‡§è‡§Ç</button>
    </div>

    <div class="note">‡§ö‡§æ‡§≤‡§æ‡§® ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§∞‡•Ç‡§™ ‡§∏‡•á ‡§∏‡•á‡§µ ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§è‡§ó‡§æ</div>

    <!-- RESULT BOX -->
    <div id="resultBox">
      <div id="resultMsg"></div>

      <div class="result-actions">
        <button id="viewPdfBtn" style="display:none;">üìÑ View PDF</button>
        <button id="historyBtn" style="display:none;">üìö Challan History</button>
      </div>
    </div>

  </div>
</div>
<!-- 
<script>
/* Hindi translation */
async function translateToHindi(text){
  if(!text) return "";
  try{
    const res = await fetch(
      "https://translate.googleapis.com/translate_a/single?client=gtx&sl=en&tl=hi&dt=t&q=" +
      encodeURIComponent(text)
    );
    const data = await res.json();
    return data[0][0][0] || text;
  }catch(e){
    return text;
  }
}

/* LIVE translate THROUGH */
let throughTimer;
throughInput.addEventListener("input", ()=>{
  clearTimeout(throughTimer);
  throughTimer = setTimeout(async ()=>{
    throughHindiPreview.value = await translateToHindi(throughInput.value.trim());
  }, 400);
});

/* Generate challan */
async function generate(){
  const btn = genBtn;
  const resultBox = document.getElementById("resultBox");
  const resultMsg = document.getElementById("resultMsg");
  const viewBtn = document.getElementById("viewPdfBtn");
  const historyBtn = document.getElementById("historyBtn");

  btn.disabled=true;
  btn.innerText="Generating...";

  const buyer=buyerInput.value.trim();
  const driver=driverInput.value.trim();
  const vehicle=vehicleInput.value.trim();
  const brick=brickInput.value;
  const qty=qtyInput.value;
  const price=priceInput.value;
  const throughHindi=throughHindiPreview.value.trim();

  if(!buyer||!driver||!vehicle||!qty||!price||!throughHindi){
    alert("‚ùå ‡§∏‡§≠‡•Ä ‡§´‡§º‡•Ä‡§≤‡•ç‡§° ‡§≠‡§∞‡§®‡§æ ‡§ú‡§º‡§∞‡•Ç‡§∞‡•Ä ‡§π‡•à");
    btn.disabled=false;
    btn.innerText="‡§ö‡§æ‡§≤‡§æ‡§® ‡§¨‡§®‡§æ‡§è‡§Ç";
    return;
  }

  const buyerHi = await translateToHindi(buyer);
  const driverHi = await translateToHindi(driver);

  const fd=new FormData();
  fd.append("buyer_name",buyer);
  fd.append("buyer_name_hindi",buyerHi);
  fd.append("driver_name",driver);
  fd.append("driver_name_hindi",driverHi);
  fd.append("vehicle_no",vehicle);
  fd.append("brick_type",brick);
  fd.append("quantity",qty);
  fd.append("total_price",price);
  fd.append("through",throughHindi);

  try{
    const res = await fetch(
      "https://script.google.com/macros/s/AKfycby2F9xcPB4B0QDBCRlV08vGxUptgOrgm_aunMzjyACZk4WCSOpbmDFdU7oHyrXd-pDLHg/exec",
      {method:"POST",body:fd}
    );

    const out = JSON.parse(await res.text());
    resultBox.style.display="block";

    if(out.status==="SUCCESS"){
      resultMsg.style.color="green";
      resultMsg.innerText="‚úÖ ‡§ö‡§æ‡§≤‡§æ‡§® ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§¨‡§® ‡§ó‡§Ø‡§æ";
      viewBtn.style.display="inline-block";
      historyBtn.style.display="inline-block";
      viewBtn.onclick=()=>window.open(out.pdfUrl,"_blank");
      historyBtn.onclick=()=>location.href="challan_history.html";
    }else{
      throw "error";
    }
  }catch{
    resultBox.style.display="block";
    resultMsg.style.color="red";
    resultMsg.innerText="‚ùå Server error";
  }

  btn.disabled=false;
  btn.innerText="‡§ö‡§æ‡§≤‡§æ‡§® ‡§¨‡§®‡§æ‡§è‡§Ç";
}
</script> -->

<script>
async function translateToHindi(text){
  if(!text) return "";
  try{
    const res = await fetch(
      "https://translate.googleapis.com/translate_a/single?client=gtx&sl=en&tl=hi&dt=t&q=" +
      encodeURIComponent(text)
    );
    const data = await res.json();
    return data[0][0][0] || text;
  }catch(e){
    return text;
  }
}

async function generate(){
  const btn = genBtn;
  const resultBox = document.getElementById("resultBox");
  const resultMsg = document.getElementById("resultMsg");
  const viewBtn = document.getElementById("viewPdfBtn");

  btn.disabled = true;
  btn.innerText = "Generating...";

  const buyer = buyerInput.value.trim();
  const driver = driverInput.value.trim();
  const vehicle = vehicleInput.value.trim();
  const brick = brickInput.value;
  const qty = qtyInput.value;
  const price = priceInput.value;
  const through = throughInput.value.trim();

  if(!buyer || !driver || !vehicle || !qty || !price || !through){
    alert("‚ùå ‡§∏‡§≠‡•Ä ‡§´‡§º‡•Ä‡§≤‡•ç‡§° ‡§≠‡§∞‡§®‡§æ ‡§ú‡§º‡§∞‡•Ç‡§∞‡•Ä ‡§π‡•à");
    btn.disabled=false;
    btn.innerText="‡§ö‡§æ‡§≤‡§æ‡§® ‡§¨‡§®‡§æ‡§è‡§Ç";
    return;
  }

  const buyerHi = await translateToHindi(buyer);
  const driverHi = await translateToHindi(driver);

  const fd = new FormData();
  fd.append("buyer_name", buyer);
  fd.append("buyer_name_hindi", buyerHi);
  fd.append("driver_name", driver);
  fd.append("driver_name_hindi", driverHi);
  fd.append("vehicle_no", vehicle);
  fd.append("brick_type", brick);
  fd.append("quantity", qty);
  fd.append("total_price", price);
  fd.append("through", through);

  try{
    const res = await fetch(
      "https://script.google.com/macros/s/AKfycby6seRRb3qWV-pqNZo3O9DYSO7QSLm28p-tzWqH5w0B5u3t5cO6o-noeCRX3hLwL7mW/exec",
      { method:"POST", body:fd }
    );

    const out = JSON.parse(await res.text());

    if(out.status === "SUCCESS"){
      resultBox.style.display="block";
      resultMsg.style.color="green";
      resultMsg.innerText="‚úÖ ‡§ö‡§æ‡§≤‡§æ‡§® ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§¨‡§® ‡§ó‡§Ø‡§æ";

      // View PDF
      viewBtn.style.display="inline-block";
      viewBtn.onclick = () => window.open(out.pdfUrl, "_blank");

      // WhatsApp Share Button
      const waBtn = document.createElement("button");
      waBtn.innerText = "üì≤ WhatsApp ‡§™‡§∞ ‡§≠‡•á‡§ú‡•á‡§Ç";
      waBtn.style.background = "#25D366";
      waBtn.style.color = "#fff";
      waBtn.style.border = "none";
      waBtn.style.borderRadius = "10px";
      waBtn.style.padding = "10px 14px";
      waBtn.style.fontWeight = "600";
      waBtn.onclick = () => {
        const msg =
          `üßæ ‡§à‡§Ç‡§ü ‡§ö‡§æ‡§≤‡§æ‡§®\n\n` +
          `‡§ñ‡§∞‡•Ä‡§¶‡§æ‡§∞: ${buyerHi}\n` +
          `‡§∞‡§æ‡§∂‡§ø: ‚Çπ${price}\n\n` +
          `PDF ‡§¶‡•á‡§ñ‡•á‡§Ç:\n${out.pdfUrl}`;
        window.open(
          "https://wa.me/?text=" + encodeURIComponent(msg),
          "_blank"
        );
      };

      document.querySelector(".result-actions").appendChild(waBtn);

    }else{
      throw "fail";
    }

  }catch(e){
    resultBox.style.display="block";
    resultMsg.style.color="red";
    resultMsg.innerText="‚ùå Server error";
  }

  btn.disabled=false;
  btn.innerText="‡§ö‡§æ‡§≤‡§æ‡§® ‡§¨‡§®‡§æ‡§è‡§Ç";
}
</script>


</body>
</html>
