<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Generate Challan</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">

<style>
*{box-sizing:border-box}
body{
  margin:0;
  font-family:Poppins;
  background:linear-gradient(135deg,#f4f6fa,#eef1f7);
}

/* Layout */
.wrapper{
  min-height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:16px;
}

.card{
  width:100%;
  max-width:620px;
  background:#fff;
  border-radius:20px;
  padding:22px;
  box-shadow:0 15px 35px rgba(0,0,0,.12)
}

h2{
  text-align:center;
  color:#b53030;
  margin-bottom:18px
}

/* Form */
.form-grid{
  display:grid;
  grid-template-columns:1fr;
  gap:12px
}

input,select,button{
  width:100%;
  padding:14px;
  border-radius:12px;
  border:1px solid #ccc;
  font-family:Poppins;
  font-size:15px
}

button{
  background:#b53030;
  color:#fff;
  border:none;
  font-weight:600;
  cursor:pointer;
  transition:.2s
}
button:disabled{
  opacity:.6;
  cursor:not-allowed
}
button:hover:not(:disabled){
  transform:translateY(-1px)
}

.note{
  margin-top:10px;
  text-align:center;
  font-size:13px;
  color:#666
}

/* Result Box */
#resultBox{
  display:none;
  margin-top:18px;
  padding:14px;
  border-radius:14px;
  background:#f9fafb;
  text-align:center
}
#resultMsg{
  font-weight:600;
  font-size:15px
}
.result-actions{
  margin-top:12px;
  display:flex;
  gap:10px;
  justify-content:center;
  flex-wrap:wrap
}
.result-actions button{
  width:auto;
  padding:10px 14px;
  border-radius:10px;
  font-size:14px
}

/* Responsive */
@media(min-width:600px){
  .form-grid{grid-template-columns:1fr 1fr}
  .full{grid-column:1/-1}
}
</style>
</head>

<body>

<div class="wrapper">
  <div class="card">

    <h2>üßæ ‡§à‡§Ç‡§ü ‡§ö‡§æ‡§≤‡§æ‡§®</h2>

    <div class="form-grid">
      <input id="buyerInput" placeholder="‡§ñ‡§∞‡•Ä‡§¶‡§æ‡§∞ ‡§ï‡§æ ‡§®‡§æ‡§Æ (English)">
<input id="driverInput" placeholder="‡§°‡•ç‡§∞‡§æ‡§á‡§µ‡§∞ ‡§ï‡§æ ‡§®‡§æ‡§Æ (English)">
<input id="vehicleInput" placeholder="‡§µ‡§æ‡§π‡§® ‡§®‡§Ç‡§¨‡§∞">

<select id="brickInput">
  <option value="1 ‡§®‡§Ç‡§¨‡§∞">1 ‡§®‡§Ç‡§¨‡§∞</option>
  <option value="2 ‡§®‡§Ç‡§¨‡§∞">2 ‡§®‡§Ç‡§¨‡§∞</option>
  <option value="‡§ñ‡§Ç‡§ú‡§∞">‡§ñ‡§Ç‡§ú‡§∞</option>
</select>

<input id="qtyInput" type="number" placeholder="‡§Æ‡§æ‡§§‡•ç‡§∞‡§æ" class="full">
<input id="priceInput" type="number" placeholder="‡§ï‡•Å‡§≤ ‡§ï‡•Ä‡§Æ‡§§ (‚Çπ)" class="full">

      <input id="throughInput" placeholder="‡§à‡§Ç‡§ü ‡§ï‡§ø‡§∏‡§ï‡•á ‡§¶‡•ç‡§µ‡§æ‡§∞‡§æ ‡§ú‡§æ ‡§∞‡§π‡•Ä ‡§π‡•à" class="full">

      <button class="full" id="genBtn" onclick="generate()">‡§ö‡§æ‡§≤‡§æ‡§® ‡§¨‡§®‡§æ‡§è‡§Ç</button>
    </div>

    <div class="note">‡§ö‡§æ‡§≤‡§æ‡§® ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§∞‡•Ç‡§™ ‡§∏‡•á ‡§∏‡•á‡§µ ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§è‡§ó‡§æ</div>

    <!-- RESULT BOX -->
    <div id="resultBox">
      <div id="resultMsg"></div>

      <div class="result-actions">
        <button id="viewPdfBtn" style="display:none;">üìÑ View PDF</button>
        <button id="historyBtn" style="display:none;">üìö Challan History</button>
      </div>
    </div>

  </div>
</div>



<!-- HIDDEN FORM -->
<form id="challanForm"
  method="POST"
  action="https://script.google.com/macros/s/AKfycbwLpdJzOaRKoVQ8m2GDGdbxWkydOX0dfFkTynsp4ZajhJ71OackU4EDj1WuxW8uI1npWQ/exec"
  target="hiddenFrame">

  <input type="hidden" name="buyer_name" id="f_buyer">
  <input type="hidden" name="buyer_name_hindi" id="f_buyer_hi">
  <input type="hidden" name="driver_name" id="f_driver">
  <input type="hidden" name="driver_name_hindi" id="f_driver_hi">
  <input type="hidden" name="vehicle_no" id="f_vehicle">
  <input type="hidden" name="brick_type" id="f_brick">
  <input type="hidden" name="quantity" id="f_qty">
  <input type="hidden" name="total_price" id="f_total_price">
  <input type="hidden" name="through" id="f_through">
</form>

<iframe name="hiddenFrame" style="display:none"></iframe>

<script>
/* Hindi translation */
async function mapNameToHindiDynamic(name){
  if(!name) return name;
  try{
    const res = await fetch(
      "https://translate.googleapis.com/translate_a/single?client=gtx&sl=en&tl=hi&dt=t&q=" +
      encodeURIComponent(name)
    );
    const data = await res.json();
    return data[0][0][0] || name;
  }catch(e){
    return name;
  }
}

/* Clear form */
function clearForm(){
  buyerInput.value="";
  driverInput.value="";
  vehicleInput.value="";
  qtyInput.value="";
  priceInput.value="";
  throughInput.value="";
  brickInput.selectedIndex=0;
}

/* Generate challan */
async function generate(){
  const btn = genBtn;
  const resultBox = document.getElementById("resultBox");
  const resultMsg = document.getElementById("resultMsg");
  const viewBtn = document.getElementById("viewPdfBtn");
  const historyBtn = document.getElementById("historyBtn");

  resultBox.style.display="none";
  viewBtn.style.display="none";
  historyBtn.style.display="none";

  btn.disabled=true;
  btn.innerText="Generating...";

  const buyer=buyerInput.value.trim();
  const driver=driverInput.value.trim();
  const vehicle=vehicleInput.value.trim();
  const brick=brickInput.value;
  const qty=qtyInput.value;
  const price=priceInput.value;
  const through=throughInput.value;

  if(!buyer||!driver||!vehicle||!qty||!price||!through){
    alert("‚ùå ‡§∏‡§≠‡•Ä ‡§´‡§º‡•Ä‡§≤‡•ç‡§° ‡§≠‡§∞‡§®‡§æ ‡§ú‡§º‡§∞‡•Ç‡§∞‡•Ä ‡§π‡•à");
    btn.disabled=false;
    btn.innerText="Generate Challan";
    return;
  }

  let buyerHi=buyer, driverHi=driver;
  buyerHi = await mapNameToHindiDynamic(buyer);
  driverHi = await mapNameToHindiDynamic(driver);

  const fd=new FormData();
  fd.append("buyer_name",buyer);
  fd.append("buyer_name_hindi",buyerHi);
  fd.append("driver_name",driver);
  fd.append("driver_name_hindi",driverHi);
  fd.append("vehicle_no",vehicle);
  fd.append("brick_type",brick);
  fd.append("quantity",qty);
  fd.append("total_price",price);
  fd.append("through",through);

  try{
    const res=await fetch(
      "https://script.google.com/macros/s/AKfycbwLpdJzOaRKoVQ8m2GDGdbxWkydOX0dfFkTynsp4ZajhJ71OackU4EDj1WuxW8uI1npWQ/exec",
      {method:"POST",body:fd}
    );
    const out=await res.json();

    resultBox.style.display="block";

    if(out.status==="SUCCESS"){
      resultMsg.style.color="green";
      resultMsg.innerText="‚úÖ Challan generated successfully";

      viewBtn.style.display="inline-block";
      historyBtn.style.display="inline-block";

      viewBtn.onclick=()=>window.open(out.pdfUrl,"_blank");
      historyBtn.onclick=()=>location.href="challan_history.html";

      clearForm();
    }else{
      resultMsg.style.color="red";
      resultMsg.innerText="‚ùå Challan generation failed";
      clearForm();
    }
  }catch(e){
    resultBox.style.display="block";
    resultMsg.style.color="red";
    resultMsg.innerText="‚ùå Server error";
  }

  btn.disabled=false;
  btn.innerText="Generate Challan";
}
</script>

</body>
</html>
