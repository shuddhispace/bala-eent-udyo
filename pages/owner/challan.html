<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Generate Challan</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">

<style>
*{box-sizing:border-box}
body{
  margin:0;
  font-family:Poppins;
  background:#f4f6fa;
}
.wrapper{
  min-height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:16px;
}
.card{
  width:100%;
  max-width:600px;
  background:#fff;
  border-radius:18px;
  padding:20px;
  box-shadow:0 12px 30px rgba(0,0,0,.1)
}
h2{
  text-align:center;
  color:#b53030;
  margin-bottom:16px
}
.form-grid{
  display:grid;
  grid-template-columns:1fr;
  gap:12px
}
input,select,button{
  width:100%;
  padding:14px;
  border-radius:12px;
  border:1px solid #ccc;
  font-family:Poppins;
  font-size:15px
}
button{
  background:#b53030;
  color:#fff;
  border:none;
  font-weight:600;
  cursor:pointer
}
.note{
  margin-top:12px;
  text-align:center;
  font-size:13px;
  color:#555
}
@media(min-width:600px){
  .form-grid{grid-template-columns:1fr 1fr}
  .full{grid-column:1/-1}
}
</style>
</head>

<body>

<div class="wrapper">
  <div class="card">
    <h2>üßæ ‡§à‡§Ç‡§ü ‡§ö‡§æ‡§≤‡§æ‡§®</h2>

    <div class="form-grid">
      <input id="buyerInput" placeholder="Buyer Name (English)">
      <input id="driverInput" placeholder="Driver Name (English)">
      <input id="vehicleInput" placeholder="Vehicle Number">

      <select id="brickInput">
        <option value="1 ‡§®‡§Ç‡§¨‡§∞">1 ‡§®‡§Ç‡§¨‡§∞</option>
        <option value="2 ‡§®‡§Ç‡§¨‡§∞">2 ‡§®‡§Ç‡§¨‡§∞</option>
        <option value="‡§ñ‡§Ç‡§ú‡§∞">‡§ñ‡§Ç‡§ú‡§∞</option>
      </select>

      <input id="qtyInput" type="number" placeholder="Quantity" class="full">

      <button class="full" onclick="generate()">Generate Challan</button>
    </div>

    <div class="note">‡§ö‡§æ‡§≤‡§æ‡§® PDF ‡§Ö‡§™‡§®‡•á ‡§Ü‡§™ ‡§¨‡§®‡•á‡§ó‡§æ ‡§î‡§∞ ‡§∏‡•á‡§µ ‡§π‡•ã‡§ó‡§æ</div>
  </div>
</div>

<!-- HIDDEN FORM -->
<form id="challanForm"
  method="POST"
  action="https://script.google.com/macros/s/AKfycbx1X-ujH-pJJ2GDlPbyOKW3dARHw7iG7cmlABrQg6t7S1tkBP0Iz-222ZnFP1Q2Sr_cXQ/exec"
  target="hiddenFrame">

  <input type="hidden" name="buyer_name" id="f_buyer">
  <input type="hidden" name="buyer_name_hindi" id="f_buyer_hi">
  <input type="hidden" name="driver_name" id="f_driver">
  <input type="hidden" name="driver_name_hindi" id="f_driver_hi">
  <input type="hidden" name="vehicle_no" id="f_vehicle">
  <input type="hidden" name="brick_type" id="f_brick">
  <input type="hidden" name="quantity" id="f_qty">
</form>

<iframe name="hiddenFrame" style="display:none"></iframe>

<script>
async function mapNameToHindiDynamic(name){
  if(!name) return "";

  try {
    const encoded = encodeURIComponent(name);
    const response = await fetch(
      `https://translate.googleapis.com/translate_a/single?client=gtx&sl=en&tl=hi&dt=t&q=${encoded}`
    );
    const result = await response.json();
    return result[0][0][0] || name;
  } catch(err) {
    console.error("Translation error:", err);
    return name;
  }
}
async function generate() {
  const buyerInput   = document.getElementById("buyerInput");
  const driverInput  = document.getElementById("driverInput");
  const vehicleInput = document.getElementById("vehicleInput");
  const brickInput   = document.getElementById("brickInput");
  const qtyInput     = document.getElementById("qtyInput");

  const buyer   = buyerInput.value.trim();
  const driver  = driverInput.value.trim();
  const vehicle = vehicleInput.value.trim();
  const brick   = brickInput.value;
  const qty     = qtyInput.value;

  if (!buyer || !driver || !vehicle || !qty) {
    alert("‚ùå All fields are required");
    return;
  }

  // Convert names to Hindi (dynamic)
  const buyerHi  = await mapNameToHindiDynamic(buyer);
  const driverHi = await mapNameToHindiDynamic(driver);

  // Prepare form data
  const formData = new FormData();
  formData.append("buyer_name", buyer);
  formData.append("buyer_name_hindi", buyerHi);
  formData.append("driver_name", driver);
  formData.append("driver_name_hindi", driverHi);
  formData.append("vehicle_no", vehicle);
  formData.append("brick_type", brick);
  formData.append("quantity", qty);

  try {
    const response = await fetch(
      "https://script.google.com/macros/s/AKfycbx1X-ujH-pJJ2GDlPbyOKW3dARHw7iG7cmlABrQg6t7S1tkBP0Iz-222ZnFP1Q2Sr_cXQ/exec",
      { method: "POST", body: formData }
    );

    const result = await response.json();

    if (result.status === "SUCCESS" && result.pdfUrl) {
      alert("‚úÖ Challan Generated Successfully!");
      // Open PDF in new tab
      window.open(result.pdfUrl, "_blank");
    } else {
      alert("‚ùå PDF URL not found in response.");
    }
  } catch (err) {
    console.error(err);
    alert("‚ùå Failed to generate challan. Check console for details.");
  }
}

</script>


</body>
</html>
