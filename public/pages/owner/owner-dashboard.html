<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üëë Owner Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
<style>
:root{
  --primary:#2563eb;
  --green:#16a34a;
  --red:#dc2626;
  --orange:#f97316;
  --bg:#f4f6f9;
  --card:#ffffff;
  --sidebar-width:260px;
  --sidebar-collapsed:70px;
  --transition-speed:.3s;
}

*{box-sizing:border-box;}
body{
  margin:0;
  font-family:Poppins,sans-serif;
  background:var(--bg);
  color:#333;
  display:flex;
}

/* SIDEBAR */
.sidebar{
  width:var(--sidebar-width);
  height:100vh;
  background:#fff;
  box-shadow:4px 0 20px rgba(0,0,0,.15);
  padding:20px;
  position:fixed;
  top:0;
  left:0;
  z-index:9999;
  transition:width var(--transition-speed), left var(--transition-speed);
  overflow:hidden;
}
.sidebar.collapsed{
  width:var(--sidebar-collapsed);
}
.sidebar a{
  display:flex;
  align-items:center;
  gap:10px;
  padding:12px 14px;
  margin-bottom:10px;
  border-radius:12px;
  color:#333;
  text-decoration:none;
  font-weight:600;
  white-space:nowrap;
}
.sidebar a:hover{background:#eee;}
.sidebar a span{flex:1;}

/* MOBILE */
@media(max-width:1024px){
  .sidebar{left:-260px;}
  .sidebar.open{left:0;}
}

/* OVERLAY */
.overlay{
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.4);
  z-index:9998;
}
.overlay.show{display:block;}

/* HEADER */
header{
  background:var(--primary);
  color:#fff;
  padding:16px 20px;
  font-size:20px;
  font-weight:600;
  display:flex;
  justify-content:space-between;
  align-items:center;
  box-shadow:0 4px 12px rgba(0,0,0,.1);
  width:100%;
  position:fixed;
  top:0;
  left:0;
  z-index:1000;
}

/* HAMBURGER */
.menu-btn, .collapse-btn{
  font-size:28px;
  cursor:pointer;
  display:none;
}
@media(max-width:1024px){ .menu-btn{display:block;} }

/* COLLAPSE BUTTON DESKTOP */
.collapse-btn{
  display:flex;
  justify-content:center;
  align-items:center;
  margin-top:20px;
  padding:10px;
  background:#f1f5f9;
  border-radius:12px;
  cursor:pointer;
}
.collapse-btn:hover{background:#e5e7eb;}

/* MAIN CONTENT */
.main{
  margin-left:var(--sidebar-width);
  width:100%;
  padding:100px 20px 20px 20px;
  transition:margin-left var(--transition-speed);
}
.sidebar.collapsed ~ .main{
  margin-left:var(--sidebar-collapsed);
}
@media(max-width:1024px){ .main{margin-left:0; padding:80px 16px 16px 16px;} }

/* SUMMARY GRID */
.summary-grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
  gap:20px;
}

.card{
  background:var(--card);
  padding:28px 20px;
  border-radius:16px;
  box-shadow:0 6px 20px rgba(0,0,0,.08);
  text-align:center;
  transition: transform .2s;
}
.card:hover{transform:translateY(-4px);}
.card h3{margin:0 0 12px;font-size:16px;color:#555;}
.card span{font-size:28px;font-weight:700;display:block;color:#111;}
.card.green span{color:var(--green);}
.card.red span{color:var(--red);}
.card.orange span{color:var(--orange);}
@media(max-width:600px){
  .card{padding:20px 12px;}
  .card span{font-size:24px;}
  .card h3{font-size:14px;}
}
</style>
</head>

<body>
<!-- SIDEBAR -->
<div class="sidebar" id="sidebar">
  <a href="/pages/owner/karmchari.html">üë∑ <span>‡§ï‡§∞‡•ç‡§Æ‡§ö‡§æ‡§∞‡•Ä</span></a>
  <a href="/pages/owner/employee-kharch.html">üí∏ <span>‡§ñ‡§∞‡•ç‡§ö</span></a>
  <a href="/pages/owner/production-entry.html">üè≠ <span>‡§â‡§§‡•ç‡§™‡§æ‡§¶‡§®</span></a>
  <a href="/pages/owner/owner-ledger.html">üìí <span>Owner Ledger</span></a>
  <a href="/pages/owner/challan.html">üöö <span>‡§ö‡§æ‡§≤‡§æ‡§®</span></a>

  <div class="collapse-btn" id="collapseBtn">‚áÜ</div>
</div>
<div class="overlay" id="overlay"></div>

<header>
  üëë Owner Dashboard
  <div class="menu-btn" id="menuBtn">‚ò∞</div>
</header>

<!-- MAIN CONTENT -->
<div class="main">
  <div class="summary-grid">
    <div class="card">
      <h3>‡§ï‡•Å‡§≤ ‡§ï‡§∞‡•ç‡§Æ‡§ö‡§æ‡§∞‡•Ä</h3>
      <span id="totalEmployees">0</span>
    </div>
    <div class="card orange">
      <h3>‡§ï‡•Å‡§≤ Advance</h3>
      <span id="totalAdvance">‚Çπ0</span>
    </div>
    <div class="card">
      <h3>‡§ï‡•Å‡§≤ ‡§à‡§Ç‡§ü Qty</h3>
      <span id="totalBricks">0</span>
    </div>
    <div class="card green">
      <h3>‡§â‡§§‡•ç‡§™‡§æ‡§¶‡§® ‡§∞‡§æ‡§∂‡§ø</h3>
      <span id="totalProduction">‚Çπ0</span>
    </div>
    <div class="card red">
      <h3>‡§ï‡•Å‡§≤ ‡§ñ‡§∞‡•ç‡§ö</h3>
      <span id="totalExpense">‚Çπ0</span>
    </div>
  </div>
</div>

<script>
const sidebar = document.getElementById("sidebar");
const overlay = document.getElementById("overlay");
const menuBtn = document.getElementById("menuBtn");
const collapseBtn = document.getElementById("collapseBtn");

// MOBILE MENU TOGGLE
menuBtn.onclick = () => {
  sidebar.classList.toggle("open");
  overlay.classList.toggle("show");
};
overlay.onclick = () => {
  sidebar.classList.remove("open");
  overlay.classList.remove("show");
};
document.querySelectorAll(".sidebar a").forEach(a => {
  a.onclick = () => {
    sidebar.classList.remove("open");
    overlay.classList.remove("show");
  };
});

// DESKTOP COLLAPSE
collapseBtn.onclick = () => {
  sidebar.classList.toggle("collapsed");
};

// DASHBOARD DATA
async function loadDashboard(){
  const empRes = await fetch("/api/employees/all");
  const empJson = await empRes.json();
  const employees = empJson.data || [];
  document.getElementById("totalEmployees").innerText = employees.length;
  const totalAdvance = employees.reduce((sum,e)=>sum+(e.advance||0),0);
  document.getElementById("totalAdvance").innerText = "‚Çπ"+totalAdvance;

  const expRes = await fetch("/api/expenses?limit=100000");
  const expJson = await expRes.json();
  const expenses = expJson.data || [];
  const totalExp = expenses.reduce((sum,e)=>sum+(e.amount||0),0);
  document.getElementById("totalExpense").innerText = "‚Çπ"+totalExp;

  const prodRes = await fetch("/api/production");
  const productions = await prodRes.json() || [];
  let totalBricks = 0, totalProdAmt = 0;
  productions.forEach(p=>{
    totalBricks += p.qty || 0;
    totalProdAmt += (p.qty || 0) * (p.price || 0);
  });
  document.getElementById("totalBricks").innerText = totalBricks;
  document.getElementById("totalProduction").innerText = "‚Çπ"+totalProdAmt;
}

// Load dashboard on page load
loadDashboard();
</script>
</body>
</html>
