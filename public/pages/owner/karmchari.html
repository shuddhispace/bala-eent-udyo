<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‡§ï‡§∞‡•ç‡§Æ‡§ö‡§æ‡§∞‡•Ä ‡§™‡•ç‡§∞‡§¨‡§Ç‡§ß‡§®</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --primary:#ff5722;
  --primary-dark:#e64a19;
  --bg-light:#f5f5f5;
  --card-bg:#fff;
  --hover-bg:#ffe0b2;
  --transition:.25s;
}

*{box-sizing:border-box;margin:0;padding:0;font-family:'Poppins',sans-serif;}
body{background:var(--bg-light);color:#333;padding:12px;}

/* PANEL */
.panel{background:var(--card-bg);padding:16px;border-radius:14px;box-shadow:0 4px 12px rgba(0,0,0,.08);margin-bottom:16px;}
.panel h2,h3{margin-bottom:12px;color:var(--primary-dark);}

/* FORM */
.panel form{display:flex;flex-wrap:wrap;gap:10px;}
.panel input{flex:1 1 160px;padding:11px 12px;border-radius:10px;border:1px solid #ccc;font-size:14px;}
.panel button{background:var(--primary);color:#fff;border:none;padding:11px 12px;border-radius:10px;cursor:pointer;transition:var(--transition);}
.panel button:hover{background:var(--primary-dark);}

/* CONTROLS */
.controls{display:flex;flex-wrap:wrap;gap:10px;margin-bottom:12px;}
.controls input{flex:1 1 200px;}

/* TABLE */
.table-container{overflow-x:auto;border-radius:14px;}
table{width:100%;border-collapse:collapse;min-width:760px;}
th,td{padding:12px;border-bottom:1px solid #eee;text-align:left;font-size:14px;}
th{background:var(--primary);color:#fff;font-weight:500;}
tr:hover{background:var(--hover-bg);}

/* PAGINATION */
.pagination{display:flex;justify-content:center;align-items:center;gap:8px;margin-top:12px;flex-wrap:wrap;}
.pagination button{padding:8px 14px;border-radius:10px;background:var(--primary);color:#fff;border:none;cursor:pointer;}
.pagination button:disabled{background:#ccc;cursor:not-allowed;}

/* TOAST */
.toast{padding:10px 14px;border-radius:10px;margin-bottom:8px;color:#fff;font-weight:500;}
.toast.success{background:#388e3c;}
.toast.error{background:#d32f2f;}

/* RESPONSIVE */
@media(max-width:600px){
  body{padding:10px;}
  .panel{padding:14px;}
  th,td{font-size:13px;}
  .pagination button{padding:7px 12px;font-size:13px;}
  #pageInfo{font-size:13px;font-weight:500;}
  #pageLimitSelect{width:100%;max-width:220px;margin:10px auto 0;padding:9px;border-radius:10px;}
}
@media(min-width:601px) and (max-width:900px){#pageLimitSelect{margin-left:10px;}}
</style>
</head>
<body>

<div id="toastContainer"></div>

<!-- ADD EMPLOYEE -->
<section class="panel form-panel">
  <h3>‚ûï ‡§®‡§Ø‡§æ ‡§ï‡§∞‡•ç‡§Æ‡§ö‡§æ‡§∞‡•Ä</h3>
  <form id="addEmployeeForm">
    <input id="empName" placeholder="‡§®‡§æ‡§Æ" required>
    <input id="empPhone" placeholder="‡§´‡•ã‡§® ‡§®‡§Ç‡§¨‡§∞">
    <input id="empAdvance" type="number" placeholder="Advance ‚Çπ">
    <button type="submit">‡§ú‡•ã‡§°‡§º‡•á‡§Ç</button>
  </form>
</section>

<!-- EMPLOYEE LIST -->
<section class="panel">
  <h2>üë∑ ‡§ï‡§∞‡•ç‡§Æ‡§ö‡§æ‡§∞‡•Ä ‡§∏‡•Ç‡§ö‡•Ä</h2>

  <div class="controls">
    <input type="text" id="employeeSearch" placeholder="‡§ï‡§∞‡•ç‡§Æ‡§ö‡§æ‡§∞‡•Ä ‡§ñ‡•ã‡§ú‡•á‡§Ç...">
  </div>

  <div class="table-container">
    <table>
      <thead>
        <tr>
          <th>ID</th>
          <th>‡§®‡§æ‡§Æ</th>
          <th>Advance</th>
          <th>‡§ñ‡§∞‡•ç‡§ö</th>
          <th>‡§à‡§Ç‡§ü (Qty)</th>
          <th>‡§â‡§§‡•ç‡§™‡§æ‡§¶‡§® ‚Çπ</th>
          <th>Balance</th>
        </tr>
      </thead>
      <tbody id="employeeTableBody">
        <tr><td colspan="7">Loading employees‚Ä¶</td></tr>
      </tbody>
      <tfoot>
        <tr>
          <td colspan="2"><strong>‡§ï‡•Å‡§≤ (Page)</strong></td>
          <td id="tfootAdvance">‚Çπ0</td>
          <td id="tfootExpense">‚Çπ0</td>
          <td id="tfootBricks">0</td>
          <td id="tfootProduction">‚Çπ0</td>
          <td id="tfootBalance">‚Çπ0</td>
        </tr>
      </tfoot>
    </table>
  </div>

  <div class="pagination">
    <button id="prevPage">‚¨Ö Prev</button>
    <span id="pageInfo"></span>
    <button id="nextPage">Next ‚û°</button>
  </div>

  <select id="pageLimitSelect">
    <option value="10">10 rows</option>
    <option value="20">20 rows</option>
    <option value="50">50 rows</option>
  </select>
</section>

<script>
const API = "/api";
const employeeTableBody = document.getElementById("employeeTableBody");
const employeeSearch = document.getElementById("employeeSearch");
const addEmployeeForm = document.getElementById("addEmployeeForm");
const empName = document.getElementById("empName");
const empPhone = document.getElementById("empPhone");
const empAdvance = document.getElementById("empAdvance");
const prevBtn = document.getElementById("prevPage");
const nextBtn = document.getElementById("nextPage");
const pageInfo = document.getElementById("pageInfo");
const pageLimitSelect = document.getElementById("pageLimitSelect");

let employees = [];
let currentPage = 1;
let pageLimit = 10;
let totalEmployees = 0;

// LOAD EMPLOYEES
async function loadEmployees(){
  const res = await fetch(`${API}/employees?page=${currentPage}&limit=${pageLimit}`);
  const data = await res.json();
  employees = data.data || [];
  totalEmployees = data.totalCount || employees.length;
  renderEmployees(employees);
  updatePagination();
}

// RENDER EMPLOYEES
function renderEmployees(list){
  employeeTableBody.innerHTML = "";
  if(list.length === 0){
    employeeTableBody.innerHTML = '<tr><td colspan="7">No employees found</td></tr>';
    document.getElementById("tfootAdvance").innerText = "‚Çπ0";
    document.getElementById("tfootExpense").innerText = "‚Çπ0";
    document.getElementById("tfootProduction").innerText = "‚Çπ0";
    document.getElementById("tfootBalance").innerText = "‚Çπ0";
    document.getElementById("tfootBricks").innerText = 0;
    return;
  }
  let adv=0, exp=0, prod=0, bal=0, bricks=0;
  list.forEach(e=>{
    const advance = Number(e.advance || 0);
    const expense = Number(e.totalExpense || 0);
    const production = Number(e.totalProduction || 0);
    const balance = Number(e.balance || (advance + production - expense));
    const totalBricks = Number(e.totalBricks || 0);
    adv += advance;
    exp += expense;
    prod += production;
    bal += balance;
    bricks += totalBricks;
    employeeTableBody.innerHTML += `<tr>
      <td>${e.empId || "-"}</td>
      <td>${e.name || "-"}</td>
      <td>‚Çπ${advance}</td>
      <td>‚Çπ${expense}</td>
      <td>${totalBricks}</td>
      <td>‚Çπ${production}</td>
      <td>‚Çπ${balance}</td>
    </tr>`;
  });
  document.getElementById("tfootAdvance").innerText = "‚Çπ" + adv;
  document.getElementById("tfootExpense").innerText = "‚Çπ" + exp;
  document.getElementById("tfootProduction").innerText = "‚Çπ" + prod;
  document.getElementById("tfootBalance").innerText = "‚Çπ" + bal;
  document.getElementById("tfootBricks").innerText = bricks;
}

// ADD EMPLOYEE
addEmployeeForm.addEventListener("submit", async e=>{
  e.preventDefault();
  const name = empName.value.trim();
  const phone = empPhone.value.trim();
  const advance = Number(empAdvance.value);
  if(!name) return alert("‡§ï‡•É‡§™‡§Ø‡§æ ‡§®‡§æ‡§Æ ‡§≠‡§∞‡•á‡§Ç");
  const res = await fetch(`${API}/employees`, {
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({name, phone, advance})
  });
  if(res.ok){
    empName.value=""; empPhone.value=""; empAdvance.value="";
    showToast("‡§ï‡§∞‡•ç‡§Æ‡§ö‡§æ‡§∞‡•Ä ‡§ú‡•ã‡§°‡§º‡§æ ‡§ó‡§Ø‡§æ","success");
    loadEmployees();
  }else{
    showToast("‡§§‡•ç‡§∞‡•Å‡§ü‡§ø: ‡§ï‡§∞‡•ç‡§Æ‡§ö‡§æ‡§∞‡•Ä ‡§ú‡•ã‡§°‡§º‡§®‡•á ‡§Æ‡•á‡§Ç","error");
  }
});

// PAGINATION
function updatePagination(){
  const totalPages = Math.ceil(totalEmployees / pageLimit) || 1;
  pageInfo.innerText = `Page ${currentPage} of ${totalPages}`;
  prevBtn.disabled = currentPage <= 1;
  nextBtn.disabled = currentPage >= totalPages;
}
prevBtn.onclick = () => { if(currentPage>1){ currentPage--; loadEmployees(); }};
nextBtn.onclick = () => { if(currentPage<Math.ceil(totalEmployees/pageLimit)){ currentPage++; loadEmployees(); }};
pageLimitSelect.onchange = e=>{ pageLimit=Number(e.target.value); currentPage=1; loadEmployees(); };

// SEARCH
employeeSearch.oninput = e => {
  const v = e.target.value.toLowerCase();
  renderEmployees(employees.filter(x=>x.name.toLowerCase().includes(v)));
};

// TOAST
function showToast(msg,type){
  const box=document.createElement("div");
  box.className=`toast ${type}`;
  box.innerText=msg;
  document.getElementById("toastContainer").appendChild(box);
  setTimeout(()=>box.remove(),4000);
}

// INITIAL LOAD
loadEmployees();
</script>

</body>
</html>
