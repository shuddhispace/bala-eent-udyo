<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‡§ï‡§∞‡•ç‡§Æ‡§ö‡§æ‡§∞‡•Ä ‡§∏‡•Ç‡§ö‡•Ä ‚Ä¢ ‡§∂‡•ç‡§∞‡•Ä ‡§¨‡§æ‡§≤‡§æ ‡§à‡§Ç‡§ü ‡§â‡§¶‡•ç‡§Ø‡•ã‡§ó</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --primary: #b53030;
  --primary-dark: #8f1d1d;
  --secondary: #fcd34d;
  --bg-light: #f8f8f8;
  --glass-hover: rgba(255,255,255,0.15);
}

/* ===== GENERAL ===== */
* { box-sizing: border-box; margin:0; padding:0; font-family: 'Poppins', sans-serif; }
body { background: var(--bg-light); color:#000; padding-top:70px; }

/* ===== HEADER ===== */
header {
  position: fixed; top:0; left:0; width:100%; height:64px;
  background: var(--primary); color:#fff; display:flex;
  align-items:center; justify-content: space-between; padding:0 24px;
  box-shadow:0 4px 10px rgba(0,0,0,0.2); z-index:1000;
}
header .logo { font-size:20px; font-weight:700; }
header nav a { color:#fff; text-decoration:none; font-weight:500; margin-left:16px; }

/* ===== SIDEBAR ===== */
.sidebar {
  position: fixed; top:64px; left:0; width:250px; height:100%;
  background:#111827; color:#fff; padding:20px; display:flex; flex-direction: column; gap:15px;
}
.sidebar a { color:#fff; text-decoration:none; padding:10px; border-radius:8px; transition:.3s; }
.sidebar a:hover { background: rgba(181,48,48,0.5); }

/* ===== MAIN ===== */
.main { margin-left:250px; padding:24px; transition:.3s; }

/* ===== TABLE ===== */
.table-container { overflow-x:auto; margin-top:20px; }
.employee-table { width:100%; border-collapse:collapse; min-width:700px; }
.employee-table thead th {
  background: linear-gradient(135deg, #b53030, #8f1d1d); color:#fff;
  padding:12px; text-align:left;
}
.employee-table tbody td { padding:10px; border-bottom:1px solid #ddd; }
.employee-table tbody tr:hover { background: var(--glass-hover); }
.employee-table tfoot td { font-weight:600; padding:10px; }

/* ===== CONTROLS ===== */
.employee-controls { display:flex; justify-content:space-between; margin-top:12px; flex-wrap:wrap; gap:10px; }
.pagination button {
  background: var(--primary); color:#fff; border:none; padding:6px 12px; border-radius:6px; cursor:pointer;
  transition:.2s;
}
.pagination button:hover { background: var(--primary-dark); }
.pagination button:disabled { background:#ccc; cursor:not-allowed; }

.page-limit select { padding:6px 10px; border-radius:6px; }

/* ===== FOOTER ===== */
footer { text-align:center; padding:20px; margin-top:40px; color:#555; }

/* ===== RESPONSIVE ===== */
@media(max-width:1024px) { .main { margin-left:0; } .sidebar { position:fixed; left:-100%; transition:.3s; } .sidebar.show { left:0; } }
@media(max-width:768px) { .employee-table { min-width:500px; } }
</style>
</head>
<body>

<header>
  <div class="logo">‡§∂‡•ç‡§∞‡•Ä ‡§¨‡§æ‡§≤‡§æ ‡§à‡§Ç‡§ü ‡§â‡§¶‡•ç‡§Ø‡•ã‡§ó</div>
  <nav class="desktop-nav">
    <a href="/owner-dashboard.html">Dashboard</a>
    <a href="#">Employees</a>
    <a href="#">Production</a>
    <a href="#" onclick="logout()">Logout</a>
  </nav>
</header>

<div class="sidebar" id="sidebar">
  <a href="/owner-dashboard.html">‡§°‡•à‡§∂‡§¨‡•ã‡§∞‡•ç‡§°</a>
  <a href="#">‡§ï‡§∞‡•ç‡§Æ‡§ö‡§æ‡§∞‡•Ä</a>
  <a href="#">‡§â‡§§‡•ç‡§™‡§æ‡§¶‡§®</a>
  <a href="#" onclick="logout()">‡§≤‡•â‡§ó‡§Ü‡§â‡§ü</a>
</div>

<div class="main">
  <h2>üë∑ ‡§ï‡§∞‡•ç‡§Æ‡§ö‡§æ‡§∞‡•Ä ‡§∏‡•Ç‡§ö‡•Ä</h2>

  <div class="table-container">
    <table class="employee-table">
      <thead>
        <tr>
          <th>ID</th>
          <th>‡§®‡§æ‡§Æ</th>
          <th>Advance</th>
          <th>‡§ñ‡§∞‡•ç‡§ö</th>
          <th>‡§à‡§Ç‡§ü (Qty)</th>
          <th>‡§â‡§§‡•ç‡§™‡§æ‡§¶‡§® ‚Çπ</th>
          <th>Balance</th>
        </tr>
      </thead>
      <tbody id="employeeTableBody">
        <tr><td colspan="7" style="text-align:center;">Loading employees‚Ä¶</td></tr>
      </tbody>
      <tfoot>
        <tr>
          <td colspan="2">‡§ï‡•Å‡§≤ (Page)</td>
          <td id="tfootAdvance">‚Çπ0</td>
          <td id="tfootExpense">‚Çπ0</td>
          <td id="tfootBricks">0</td>
          <td id="tfootProduction">‚Çπ0</td>
          <td id="tfootBalance">‚Çπ0</td>
        </tr>
      </tfoot>
    </table>
  </div>

  <div class="employee-controls">
    <div class="pagination">
      <button id="prevPage">‚¨Ö Prev</button>
      <span id="pageInfo">Page 1</span>
      <button id="nextPage">Next ‚û°</button>
    </div>

    <div class="page-limit">
      <label>Rows:</label>
      <select id="pageLimitSelect">
        <option value="10">10</option>
        <option value="20">20</option>
        <option value="50">50</option>
      </select>
      <button id="showAll">Show All</button>
    </div>
  </div>
</div>

<footer>
¬© <span id="year"></span> ‡§∂‡•ç‡§∞‡•Ä ‡§¨‡§æ‡§≤‡§æ ‡§à‡§Ç‡§ü ‡§â‡§¶‡•ç‡§Ø‡•ã‡§ó ‚Ä¢ ‡§∏‡§≠‡•Ä ‡§Ö‡§ß‡§ø‡§ï‡§æ‡§∞ ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§
</footer>

<div id="toastContainer"></div>

<script>
const API = "/api";
const employeeTableBody = document.getElementById("employeeTableBody");
const prevBtn = document.getElementById("prevPage");
const nextBtn = document.getElementById("nextPage");
const showAllBtn = document.getElementById("showAll");
const pageLimitSelect = document.getElementById("pageLimitSelect");
const pageInfo = document.getElementById("pageInfo");
const tfootAdvance = document.getElementById("tfootAdvance");
const tfootExpense = document.getElementById("tfootExpense");
const tfootBricks = document.getElementById("tfootBricks");
const tfootProduction = document.getElementById("tfootProduction");
const tfootBalance = document.getElementById("tfootBalance");

let employees = [];
let currentPage = 1;
let pageLimit = 10;
let totalEmployees = 0;

// Toast
function notify(msg,type="info"){
  const box=document.createElement("div");
  box.className=`toast ${type}`;
  box.innerText=msg;
  document.getElementById("toastContainer").appendChild(box);
  setTimeout(()=>box.remove(),4000);
}

// Dynamic year
document.getElementById("year").textContent = new Date().getFullYear();

// Logout
function logout(){ localStorage.removeItem("OWNER_AUTH"); window.location.href="/pages/owner-login.html"; }

// Load Employees
async function loadEmployees(showAll=false){
  const url = showAll ? `${API}/employees?limit=100000` : `${API}/employees?page=${currentPage}&limit=${pageLimit}`;
  const res = await fetch(url);
  const data = await res.json();
  employees = data.data || [];
  totalEmployees = data.totalCount || 0;
  renderEmployees(employees);
  updatePagination(totalEmployees, showAll);
}

// Render table
function renderEmployees(list){
  employeeTableBody.innerHTML="";
  let adv=0,exp=0,prod=0,bal=0,bricks=0;
  list.forEach(e=>{
    adv+=e.advance||0;
    exp+=e.totalExpense||0;
    prod+=e.totalProduction||0;
    bal+=e.balance||0;
    bricks+=e.totalBricks||0;

    employeeTableBody.innerHTML+=`
      <tr>
        <td>${e.empId}</td>
        <td>${e.name}</td>
        <td>‚Çπ${e.advance||0}</td>
        <td>‚Çπ${e.totalExpense||0}</td>
        <td>${e.totalBricks||0}</td>
        <td>‚Çπ${e.totalProduction||0}</td>
        <td>‚Çπ${e.balance||0}</td>
      </tr>`;
  });

  tfootAdvance.innerText="‚Çπ"+adv;
  tfootExpense.innerText="‚Çπ"+exp;
  tfootBricks.innerText=bricks;
  tfootProduction.innerText="‚Çπ"+prod;
  tfootBalance.innerText="‚Çπ"+bal;
}

// Pagination
function updatePagination(total,showAll=false){
  const totalPages=Math.ceil(total/pageLimit)||1;
  pageInfo.innerText=showAll ? `All ${total} records` : `Page ${currentPage} of ${totalPages}`;
  prevBtn.disabled=currentPage<=1 || showAll;
  nextBtn.disabled=currentPage>=totalPages || showAll;
}

// Events
document.addEventListener("DOMContentLoaded",()=>{
  loadEmployees();

  pageLimitSelect.onchange=e=>{
    pageLimit=Number(e.target.value); currentPage=1; loadEmployees();
  };
  prevBtn.onclick=()=>{ if(currentPage>1){ currentPage--; loadEmployees(); } };
  nextBtn.onclick=()=>{ currentPage++; loadEmployees(); };
  showAllBtn.onclick=()=>{ currentPage=1; loadEmployees(true); };
});
</script>

</body>
</html>
